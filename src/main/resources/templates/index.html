<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta>
  <title th:text="${title} ?: 'Pastelería'">Pastelería</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap y Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    html, body {
        height: 100%;
        margin: 0;
        font-family: 'Poppins', sans-serif;
        background-color: #ffffff; /* Fondo blanco */
        color: #333;
    }
    .page-container {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
    }
    .content-wrapper {
    flex: 1;
    }
    .content { padding: 20px; }
    footer {
        padding: 15px 0;
        text-align: center;
        font-size: 0.9em;
        background-color: #f7e1c0; /* Givry para el footer */
    }
    .card {
        border: 1px solid #dee2e6;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        transition: box-shadow 0.2s;
    }
    .card:hover {
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    }
    .card img { height: 180px; object-fit: cover; border-radius: 8px 8px 0 0; }
    h4 {
        color: #000000; /* Títulos en negro */
        margin-bottom: 20px;
    }
    .chart-container {
        border-radius: 8px;
        background-color: white;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    .btn {
        background-color: #ffebeb; /* Botones rosa */
        color: black; /* Texto negro en botones */
    }
    .btn:hover {
        background-color: #d9d2c4; /* Hover en color sisal */
    }
  </style>
</head>
<body>
<div class="page-container">

    <div class="content-wrapper">
  <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark border-bottom border-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Hecho con Amor</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarNav" aria-controls="navbarNav"
                    aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" href="/index">
                            <i class="bi bi-house-door me-2"></i>Inicio
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/usuarios">
                            <i class="bi bi-people me-2"></i>Usuarios
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/categorias">
                            <i class="bi bi-tags me-2"></i>Categorías
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/productos">
                            <i class="bi bi-box-seam me-2"></i>Productos
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/clientes">
                            <i class="bi bi-box-seam me-2"></i>Clientes
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- Contenido principal -->
    <main class="flex-grow content">
      <h4 class="mb-4"></h4>
      <div class="row g-4">
        <div class="col-md-4" th:each="producto : ${productosMasVendidos}">
          <div class="card shadow-sm">
            <div class="card-body">
              <h5 class="card-title" th:text="${producto.nombre}">Nombre</h5>
              <p class="card-text" th:text="${producto.descripcion}">Descripción</p>
              <a th:href="@{/ecommerce/verDetalle/{id}(id=${producto.idProducto})}" class="btn">Ver más</a>
            </div>
          </div>
        </div>
      </div>
        <div class="col-md-4">
          <div class="">
            <div class="">
              <h5 class=""></h5>
              <p class=""></p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="">
            <div class="">
              <h5 class="">  </h5>
              <p class=""></p>
            </div>
          </div>
        </div>
      </div>

      <h4 class="mb-4">Gráficos</h4>
      <div class="row g-4">
        <div class="col-md-6">
          <div class="chart-container">
            <div id="graficoVentas" style="width: 100%; height: 350px;"></div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="chart-container">
            <div id="graficoSemanal" style="width: 100%; height: 350px;"></div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="chart-container">
            <div id="graficoMasVendidos" style="width: 100%; height: 350px;"></div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="chart-container">
            <div id="graficoClientesMasVentas" style="width: 100%; height: 350px;"></div>
          </div>
        </div>
          <div class="col-md-6">
              <div class="chart-container">
                  <div id="graficoCategoriasVendidas" style="width: 100%; height: 500px;"></div>
              </div>
          </div>
      </div>
    </main>
  </div>
<!-- Scripts globales -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>

<!-- Aquí irían todos tus scripts de gráficos -->

<script>
    window.addEventListener('resize', function() {
      echarts.getInstanceByDom(document.getElementById('graficoVentas'))?.resize();
      echarts.getInstanceByDom(document.getElementById('graficoSemanal'))?.resize();
      echarts.getInstanceByDom(document.getElementById('graficoMasVendidos'))?.resize();
      echarts.getInstanceByDom(document.getElementById('graficoCategoriasVendidas'))?.resize();
      echarts.getInstanceByDom(document.getElementById('graficoClientesMasVentas'))?.resize();
    });
</script>
<script>
  fetch('/ecommerce/api/ventas-mensuales')
    .then(res => res.json())
    .then(data => {
      const meses = data.map(v => v.mes);
      const totales = data.map(v => v.total);

      const chart = echarts.init(document.getElementById('graficoVentas'));
      const options = {
        title: { text: 'Ventas Mensuales' },
        xAxis: { type: 'category', data: meses },
        yAxis: { type: 'value' },
        series: [{ data: totales, type: 'bar' }]
      };
      chart.setOption(options);
    });
</script>
<script>
  fetch('/ecommerce/api/ventas-semanales')
    .then(res => res.json())
    .then(data => {
      const dias = data.map(v => v.dia);
      const totales = data.map(v => v.total);

      const chartSemanal = echarts.init(document.getElementById('graficoSemanal'));
      const optionSemanal = {
        title: { text: 'Ventas Semanales' },
        xAxis: { type: 'category', data: dias },
        yAxis: { type: 'value' },
        series: [{ data: totales, type: 'line' }]
      };
      chartSemanal.setOption(optionSemanal);
    });
</script>
<script>
  fetch('/ecommerce/api/productos-mas-vendidos')
    .then(res => res.json())
    .then(data => {
      const nombres = data.map(p => p.nombre);
      const cantidades = data.map(p => p.cantidadVendida);

      const chartDom = document.getElementById('graficoMasVendidos');
      const myChart = echarts.init(chartDom);
      const option = {
        title: { text: 'Productos Más Vendidos' },
        xAxis: { type: 'category', data: nombres },
        yAxis: { type: 'value' },
        series: [{
          data: cantidades,
          type: 'bar',
          itemStyle: {
            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
              { offset: 0, color: '#007bff' },
              { offset: 0.5, color: '#0056b3' },
              { offset: 1, color: '#0056b3' }
            ])
          }
        }]
      };
      myChart.setOption(option);
    });
</script>
<script>
  fetch('/ecommerce/api/categorias-mas-vendidas')
  .then(res => res.json())
  .then(data => {
    const categorias = data.map(c => ({ value: c.cantidadVendida, name: c.nombre }));

    const chartDom = document.getElementById('graficoCategoriasVendidas');
    const myChart = echarts.init(chartDom);
    const option = {
      title: {
        text: 'Categorías Más Vendidas',
        left: 'center',
        top: 20,
        textStyle: { color: '#333' }
      },
      tooltip: { trigger: 'item' },
      series: [{
        name: 'Categoría',
        type: 'pie',
        radius: '55%',
        center: ['50%', '50%'],
        data: categorias.sort((a, b) => a.value - b.value),
        roseType: 'radius',
        label: { color: '#333' },
        labelLine: {
          lineStyle: { color: '#888' },
          smooth: 0.2,
          length: 10,
          length2: 20
        },
        itemStyle: {
          color: function(params) {
            const colors = ['#007bff', '#6c757d', '#28a745', '#dc3545', '#ffc107', '#17a2b8', '#6610f2'];
            return colors[params.dataIndex % colors.length];
          },
          shadowBlur: 40,
          shadowColor: 'rgba(0,0,0,0.15)'
        },
        animationType: 'scale',
        animationEasing: 'elasticOut',
        animationDelay: idx => Math.random() * 200
      }]
    };
    myChart.setOption(option);
  });
</script>
<script>
  fetch('/ecommerce/api/clientes-mas-ventas')
  .then(res => res.json())
  .then(data => {
    const nombres = data.map(c => c.nombre);
    const ventas = data.map(c => c.ventas);

    const chartDom = document.getElementById('graficoClientesMasVentas');
    const myChart = echarts.init(chartDom);
    const option = {
      title: { text: 'Clientes con Más Ventas', left: 'center', textStyle: { color: '#333' } },
      tooltip: { trigger: 'axis' },
      xAxis: { type: 'value' },
      yAxis: { type: 'category', data: nombres, inverse: true },
      series: [{
        data: ventas,
        type: 'bar',
        itemStyle: {
          color: function(params) {
            const colors = ['#007bff', '#6c757d', '#28a745', '#dc3545', '#ffc107', '#17a2b8', '#6610f2'];
            return colors[params.dataIndex % colors.length];
          }
        },
        label: { show: true, position: 'right', color: '#333' }
      }]
    };
    myChart.setOption(option);
  });
</script>
</body>
</html>
